<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noodle Concierge Editor - Client Access</title>
    <script src="https://cdn.tiny.cloud/1/j5zovf5oihbeh6drm8cljk1lcttgms97vr01owd506v7rr70/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            background-color: #f5f5f5;
        }
        .editor-container {
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .control-panel {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 13px;
        }
        .control-panel h2 {
            color: #1678F2;
            margin: 0 0 8px 0;
            font-size: 16px;
        }
        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .control-row:last-child {
            margin-bottom: 0;
        }
        .instructions {
            flex: 1;
            margin-right: 15px;
        }
        .instructions ul {
            margin: 0;
            padding-left: 18px;
        }
        .instructions li {
            margin-bottom: 3px;
        }
        .send-button {
            background: #10B981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
        }
        .send-button:hover {
            background: #0d9968;
        }
        .save-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #10B981;
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            display: none;
            font-size: 12px;
        }
        .draft-status {
            font-size: 11px;
            color: #6b7280;
            margin-top: 4px;
            font-style: italic;
        }
        .draft-restored {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 12px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="draft-restored" id="draftRestored">
            Draft restored from previous session
        </div>
        <div class="control-panel">
            <h2>Noodle Concierge Document Editor</h2>
            <div class="control-row">
                <div class="instructions">
                    <strong>Instructions:</strong>
                    <ul>
                        <li>Edit text directly in the document below</li>
                        <li>Use the toolbar for formatting (bold, colors, etc.)</li>
                        <li>Your changes are automatically saved every 30 seconds</li>
                        <li>Fill in your details and click Submit when finished editing</li>
                    </ul>
                </div>
                <form id="documentForm" action="https://formspree.io/f/movlvgpa" method="POST" style="display: flex; gap: 8px; align-items: flex-end;">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label style="font-size: 11px; font-weight: 500;">Your Name:</label>
                        <input type="text" name="client_name" required style="padding: 4px 6px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; width: 120px;">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label style="font-size: 11px; font-weight: 500;">Your Email:</label>
                        <input type="email" name="client_email" required style="padding: 4px 6px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; width: 140px;">
                    </div>
                    <input type="hidden" name="html_content" id="htmlContent">
                    <button type="submit" class="send-button">
                        Submit Document
                    </button>
                </form>
            </div>
            <div class="draft-status" id="draftStatus">
                Your work is automatically saved locally
            </div>
        </div>

        <textarea id="editor"></textarea>
    </div>

    <div class="save-indicator" id="saveIndicator">
        Document saved automatically
    </div>

    <script>
        // Draft management functions
        const DRAFT_KEY = 'noodle-concierge-draft';
        let autoSaveTimeout;
        
        function saveDraft() {
            try {
                if (!tinymce.get('editor')) return;
                
                const draftData = {
                    content: tinymce.get('editor').getContent(),
                    clientName: document.querySelector('input[name="client_name"]').value,
                    clientEmail: document.querySelector('input[name="client_email"]').value,
                    savedAt: new Date().toISOString(),
                    version: '1.0'
                };
                
                localStorage.setItem(DRAFT_KEY, JSON.stringify(draftData));
                updateDraftStatus('Draft saved locally');
            } catch (error) {
                console.warn('Could not save draft to localStorage:', error);
            }
        }
        
        function loadDraft() {
            try {
                const draftJson = localStorage.getItem(DRAFT_KEY);
                if (!draftJson) return null;
                
                return JSON.parse(draftJson);
            } catch (error) {
                console.warn('Could not load draft from localStorage:', error);
                clearDraft(); // Clear corrupted data
                return null;
            }
        }
        
        function clearDraft() {
            try {
                localStorage.removeItem(DRAFT_KEY);
                updateDraftStatus('Your work is automatically saved locally');
            } catch (error) {
                console.warn('Could not clear draft:', error);
            }
        }
        
        function hasDraft() {
            try {
                return localStorage.getItem(DRAFT_KEY) !== null;
            } catch (error) {
                return false;
            }
        }
        
        function updateDraftStatus(message) {
            const statusElement = document.getElementById('draftStatus');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }
        
        function debouncedAutoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(saveDraft, 3000); // 3 second delay
        }
        
        function restoreDraftIfExists() {
            const draft = loadDraft();
            if (draft && draft.content) {
                // Show restoration notification
                const restoredNotification = document.getElementById('draftRestored');
                restoredNotification.style.display = 'block';
                setTimeout(() => {
                    restoredNotification.style.display = 'none';
                }, 5000);
                
                // Restore form fields
                if (draft.clientName) {
                    document.querySelector('input[name="client_name"]').value = draft.clientName;
                }
                if (draft.clientEmail) {
                    document.querySelector('input[name="client_email"]').value = draft.clientEmail;
                }
                
                // Update status with timestamp
                const savedDate = new Date(draft.savedAt);
                updateDraftStatus(`Draft from ${savedDate.toLocaleDateString()} ${savedDate.toLocaleTimeString()}`);
                
                return draft.content;
            }
            return null;
        }

        tinymce.init({
            selector: '#editor',
            height: 800,
            
            // Plugins for functionality
            plugins: [
                'advlist', 'autolink', 'lists', 'link', 'image', 'charmap',
                'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
                'insertdatetime', 'media', 'table', 'help', 'wordcount', 'save',
                'importcss', 'autosave'
            ],
            
            // Toolbar configuration
            toolbar: 'save | undo redo | formatselect | bold italic underline strikethrough | ' +
                    'forecolor backcolor | alignleft aligncenter alignright alignjustify | ' +
                    'bullist numlist outdent indent | table | link image | ' +
                    'removeformat | help | fullscreen | code',
            
            // Content CSS - load your custom styles
            content_css: './noodle-styles.css',
            
            // Import CSS classes for formatting dropdown
            importcss_append: true,
            importcss_selector_filter: function(selector) {
                // Include your custom classes in the format dropdown
                return /\.(hero-title|hero-subtitle|hero-tagline|card|card-header|text-blue|text-green|text-orange|amount|descriptor|footer)/.test(selector);
            },
            
            // Auto-save functionality
            autosave_interval: '30s',
            autosave_restore_when_empty: true,
            
            // Setup function to load content and configure
            setup: function (editor) {
                // Pre-load your document content
                editor.on('init', function () {
                    // Try to restore draft first, otherwise load default content
                    const draftContent = restoreDraftIfExists();
                    const contentToLoad = draftContent || `
                        <div class="header" style="margin-bottom: 0.3rem;">
                            <img src="rectangle_logo_and_name.png" alt="Noodle Seed" class="logo-image">
                            <h1 class="hero-title">Noodle Concierge</h1>
                            <p class="hero-subtitle">AI-Powered Software that Contacts, Negotiates, and Retains Tenants For You</p>
                            <p class="hero-tagline" style="color: #10B981; font-weight: 600;">$0 Upfront Cost – Pay Only for Saved Renewals</p>
                        </div>
                        
                        <div class="col-12">
                            <div class="card" style="border-left-color: #ef4444;">
                                <div class="card-header" style="background: #ef4444;">THE PROBLEM</div>
                                <h3 style="font-size: 1rem; font-weight: 700; color: #374151; margin-bottom: 0.25rem; text-align: center;">Half of All US Apartment Renters Leave Every Year</h3>
                                
                                <div style="display: table; width: 100%; margin-bottom: 0.2rem;">
                                    <div style="display: table-cell; width: 50%; text-align: center; padding: 0.2rem;">
                                        <div style="background: #ef4444; color: white; padding: 0.3rem; border-radius: 6px;">
                                            <div style="font-size: 1.1rem; font-weight: 700;">54%</div>
                                            <div style="font-size: 0.7rem; opacity: 0.9;">National Renewal Rate</div>
                                        </div>
                                    </div>
                                    <div style="display: table-cell; width: 50%; text-align: center; padding: 0.2rem;">
                                        <div style="background: #ef4444; color: white; padding: 0.3rem; border-radius: 6px;">
                                            <div style="font-size: 1.1rem; font-weight: 700;">$5,500+</div>
                                            <div style="font-size: 0.7rem; opacity: 0.9;">CA Turnover Cost</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="background: rgba(239, 68, 68, 0.1); border-radius: 0 8px 0 8px; padding: 0.25rem; text-align: center;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #374151;">The Main Reason: Management unresponsiveness or dissatisfaction</div>
                                    <div style="font-size: 0.7rem; color: #6b7280; margin-top: 0.1rem;">Total turnover costs include: Broker fees $3,000 + Vacancy loss $1,500 + Unit prep $1,000 + Advertising</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <div class="card technology">
                                <div class="card-header technology">THE SOLUTION</div>
                                <h3 style="font-size: 1.1rem; font-weight: 700; color: #F59E0B; margin-bottom: 0.3rem; text-align: center;">AI-Powered Digital Concierge</h3>
                                
                                <div style="background: #fff7ed; padding: 0.25rem; border-radius: 0 8px 0 8px; margin-bottom: 0.2rem; text-align: center;">
                                    <div style="font-size: 0.8rem; font-weight: 600; color: #F59E0B;">Proactive Multi-Channel: EMAIL • SMS • PHONE • APP</div>
                                </div>
                                
                                <div style="background: #f0f9ff; padding: 0.25rem; border-radius: 0 8px 0 8px; margin-bottom: 0.2rem; text-align: center;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #1678F2;">Pre-Move-In → Living → Renewal: Complete AI lifecycle management</div>
                                </div>
                                
                                <div class="two-column">
                                    <div class="column">
                                        <h4 style="font-size: 0.8rem; font-weight: 600; color: #374151; margin-bottom: 0.15rem;">Zero Tenant Adoption Required</h4>
                                        <ul style="list-style: none; padding: 0; margin: 0;">
                                            <li style="font-size: 0.75rem; position: relative; padding-left: 1rem; margin-bottom: 0.1rem;">
                                                <span style="position: absolute; left: 0; color: #F59E0B;">•</span>
                                                Complete lifecycle management
                                            </li>
                                            <li style="font-size: 0.75rem; position: relative; padding-left: 1rem;">
                                                <span style="position: absolute; left: 0; color: #F59E0B;">•</span>
                                                No app downloads needed
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="column">
                                        <h4 style="font-size: 0.8rem; font-weight: 600; color: #374151; margin-bottom: 0.15rem;">AI-Powered Renewal Focus</h4>
                                        <ul style="list-style: none; padding: 0; margin: 0;">
                                            <li style="font-size: 0.75rem; position: relative; padding-left: 1rem; margin-bottom: 0.1rem;">
                                                <span style="position: absolute; left: 0; color: #F59E0B;">•</span>
                                                Automated renewal negotiation
                                            </li>
                                            <li style="font-size: 0.75rem; position: relative; padding-left: 1rem;">
                                                <span style="position: absolute; left: 0; color: #F59E0B;">•</span>
                                                Sentiment analysis & risk scoring
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">THE VALUE</div>
                                <h3 style="font-size: 1.1rem; font-weight: 700; color: #1678F2; margin-bottom: 0.3rem; text-align: center;">Success-Based Value Creation</h3>
                                
                                <div style="background: #f8fafc; padding: 0.25rem; border-radius: 0 8px 0 8px; margin-bottom: 0.2rem;">
                                    <div style="display: table; width: 100%;">
                                        <div style="display: table-cell; width: 50%; text-align: center; padding: 0.15rem;">
                                            <div style="background: #ef4444; color: white; padding: 0.25rem; border-radius: 4px;">
                                                <div style="font-size: 0.9rem; font-weight: 700;">$5,500+</div>
                                                <div style="font-size: 0.65rem; opacity: 0.9;">Turnover Cost</div>
                                            </div>
                                        </div>
                                        <div style="display: table-cell; width: 50%; text-align: center; padding: 0.15rem;">
                                            <div style="background: #10B981; color: white; padding: 0.25rem; border-radius: 4px;">
                                                <div style="font-size: 0.9rem; font-weight: 700;">$720</div>
                                                <div style="font-size: 0.65rem; opacity: 0.9;">Our Fee (2% of full lease)</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="text-align: center; margin-top: 0.15rem;">
                                        <div style="font-size: 0.7rem; font-weight: 600; color: #10B981;">Fee Only for Successful Renewals • No Upfront Investment</div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-6">
                                        <div style="background: #eff6ff; padding: 0.4rem; border-radius: 0 8px 0 8px; margin-bottom: 0.2rem; text-align: center;">
                                            <div style="font-size: 0.9rem; font-weight: 700; color: #1678F2; margin-bottom: 0.15rem;">Property Management Companies</div>
                                            <ul style="list-style: none; padding: 0; margin: 0; text-align: left;">
                                                <li style="margin-bottom: 0.1rem; font-size: 0.7rem;">• Zero investment required</li>
                                                <li style="font-size: 0.7rem;">• Success-based fees only</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div style="background: #ecfdf5; padding: 0.4rem; border-radius: 0 8px 0 8px; margin-bottom: 0.2rem; text-align: center;">
                                            <div style="font-size: 0.9rem; font-weight: 700; color: #10B981; margin-bottom: 0.15rem;">Property Owners</div>
                                            <ul style="list-style: none; padding: 0; margin: 0; text-align: left;">
                                                <li style="margin-bottom: 0.1rem; font-size: 0.7rem;">• Massive savings vs turnover costs</li>
                                                <li style="font-size: 0.7rem;">• Performance-based pricing</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <div class="card" style="border-left-color: #10B981;">
                                <div class="card-header" style="background: #10B981;">NEXT STEPS</div>
                                <div style="background: rgba(16, 185, 129, 0.1); border-radius: 0 8px 0 8px; padding: 0.25rem; text-align: center;">
                                    <div style="font-size: 0.8rem; font-weight: 600; color: #10B981;">Ready to reduce turnover costs? Schedule your portfolio analysis today</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="footer">
                            <p><strong>Fahd Rafi</strong>, Founder, TheNoodleSeed Corporation • noodleseed.com • fahd@noodleseed.com</p>
                            <p style="font-size: 0.7rem; color: #6b7280; margin-top: 0.2rem; font-style: italic;">California market: typical turnover costs 8-12%+ of annual rent due to landlord-paid broker fees. Our fee: 2% of full lease contract value, charged only for successful renewals (no charge for management interventions).</p>
                        </div>
                    `;
                    
                    editor.setContent(contentToLoad);
                });
                
                // Auto-save on content changes
                editor.on('change', function() {
                    showSaveIndicator();
                    debouncedAutoSave();
                });
                
                // Auto-save on typing (with debouncing)
                editor.on('keyup', function() {
                    debouncedAutoSave();
                });
                
                // Custom save function
                editor.addCommand('mceSave', function() {
                    saveDraft();
                });
            }
        });
        
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }
        
        // Handle form submission
        document.addEventListener('DOMContentLoaded', function() {
            // Add form field auto-save listeners
            const nameField = document.querySelector('input[name="client_name"]');
            const emailField = document.querySelector('input[name="client_email"]');
            
            nameField.addEventListener('blur', debouncedAutoSave);
            nameField.addEventListener('input', debouncedAutoSave);
            emailField.addEventListener('blur', debouncedAutoSave);
            emailField.addEventListener('input', debouncedAutoSave);
            
            document.getElementById('documentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get the current document content from TinyMCE
                const content = tinymce.get('editor').getContent();
                
                // Set the hidden field with the HTML content
                document.getElementById('htmlContent').value = content;
                
                // Show loading state
                const submitButton = this.querySelector('button[type="submit"]');
                const originalText = submitButton.textContent;
                submitButton.textContent = 'Submitting...';
                submitButton.disabled = true;
                
                // Submit the form
                fetch(this.action, {
                    method: 'POST',
                    body: new FormData(this),
                    headers: {
                        'Accept': 'application/json'
                    }
                }).then(response => {
                    if (response.ok) {
                        clearDraft(); // Clear saved draft on successful submission
                        showSuccessMessage();
                    } else {
                        throw new Error('Form submission failed');
                    }
                }).catch(error => {
                    showErrorMessage();
                }).finally(() => {
                    submitButton.textContent = originalText;
                    submitButton.disabled = false;
                });
            });
        });
        
        function showSuccessMessage() {
            const successModal = document.createElement('div');
            successModal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            successModal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 400px; text-align: center;">
                    <h2 style="color: #10B981; margin-bottom: 20px;">Document Submitted Successfully!</h2>
                    <p style="margin-bottom: 20px;">Your edited document has been sent to Fahd. You should receive a confirmation email shortly.</p>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: #10B981; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px;">
                        Great!
                    </button>
                </div>
            `;
            
            document.body.appendChild(successModal);
        }
        
        function showErrorMessage() {
            const errorModal = document.createElement('div');
            errorModal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            errorModal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 400px; text-align: center;">
                    <h2 style="color: #ef4444; margin-bottom: 20px;">Submission Failed</h2>
                    <p style="margin-bottom: 20px;">There was an issue submitting your document. Please try again or contact Fahd directly at:</p>
                    <p style="font-weight: bold; color: #1678F2; margin-bottom: 20px;">fahd@noodleseed.com</p>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: #1678F2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px;">
                        OK
                    </button>
                </div>
            `;
            
            document.body.appendChild(errorModal);
        }
    </script>
</body>
</html>